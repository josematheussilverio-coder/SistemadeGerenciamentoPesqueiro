<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Detalhes da Comanda #{{ comanda.id }}</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-success mb-4">
        <a class="navbar-brand" href="{% url 'index' %}">Fishing Management</a>
        <div class="navbar-nav ml-auto">
            <a class="nav-link" href="{% url 'comanda_list' %}">Voltar para Lista</a>
        </div>
    </nav>

    <div class="container">
        
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Itens Consumidos</h5>
            <a href="{% url 'adicionar_item' comanda.id %}" class="btn btn-primary btn-sm">
                + Adicionar Produto
            </a>
        </div>

        <div class="card shadow mb-4">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h4 class="text-success mb-0">Comanda #{{ comanda.id }}</h4>
                {% if comanda.aberta %}
                    <span class="badge badge-success px-3 py-2">ABERTA</span>
                {% else %}
                    <span class="badge badge-secondary px-3 py-2">FECHADA</span>
                {% endif %}
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p class="mb-1 text-muted">Cliente</p>
                        <h5>{{ comanda.cliente.nome }}</h5>
                    </div>
                    <div class="col-md-6 text-md-right">
                        <p class="mb-1 text-muted">Data de Abertura</p>
                        <h5>{{ comanda.data_criacao|date:"d/m/Y H:i" }}</h5>
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow">
            <div class="card-header bg-white">
                <h5 class="mb-0">Itens Consumidos</h5>
            </div>
            <div class="card-body p-0">
                <table class="table table-striped mb-0">
                    <thead class="thead-light">
                        <tr>
                            <th>Produto</th>
                            <th class="text-center">Qtd</th>
                            <th class="text-right">Preço Unit.</th>
                            <th class="text-right">Subtotal</th>
                            <th class="text-center" style="width: 50px;">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in comanda.itemcomanda_set.all %}
                        <tr>
                            <td>{{ item.produto.nome }}</td>
                            <td class="text-center">{{ item.quantidade|floatformat:1 }}</td>
                            <td class="text-right">R$ {{ item.produto.preco }}</td>
                            <td class="text-right"><strong>R$ {{ item.subtotal|floatformat:2 }}</strong></td>
                            
                            <td class="text-center">
                                <a href="{% url 'item_comanda_delete' item.id %}" class="btn btn-sm btn-outline-danger" title="Remover Item">
                                    &times;
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center py-4 text-muted">
                                Nenhum item adicionado nesta comanda ainda.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    
                    <tfoot class="bg-white">
                        <tr>
                            <td colspan="3" class="text-right pt-3"><strong>TOTAL A PAGAR:</strong></td>
                            
                            <td class="text-right pt-3 text-success">
                                <h4 class="font-weight-bold">R$ {{ comanda.total|floatformat:2 }}</h4>
                            </td>
                            
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        
        <br>
        <div class="text-center mb-5">
            <a href="{% url 'comanda_list' %}" class="btn btn-secondary">Voltar</a>
            <a href="{% url 'comanda_delete' comanda.id %}" class="btn btn-primary ml-2">Pagar Comanda</a>
            
            </div>
    </div>

</body>
</html>